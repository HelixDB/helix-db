# helix-lib

Embeddable graph database SDK for HelixDB.

## What It Does

- Compiles `.hx` schema and queries at build time
- Generates type-safe Rust handlers
- Provides simple query execution API
- Compatible with HelixDB server databases

## Quick Start

### 1. Add to Cargo.toml

```toml
[dependencies]
helix-lib = "0.1.0"
serde = { version = "1.0", features = ["derive"] }
sonic-rs = "0.3"

[build-dependencies]
helix-lib = "0.1.0"
```

### 2. Create build.rs

```rust
fn main() {
    helix_lib::build::compile_queries_default()
        .expect("Failed to compile queries");
}
```

### 3. Create Schema

`queries/schema.hx`:

```hql
NODE User {
  name: String
  email: String
}
```

### 4. Create Queries

`queries/queries.hx`:

```hql
QUERY GetUsers() =>
  users <- N<User>
  RETURN users
```

### 5. Use in Code

```rust
mod queries; // Generated by build.rs

use helix_lib::{HelixDB, ResponseExt};
use serde::Deserialize;
use sonic_rs::json;

#[derive(Deserialize)]
struct GetUsersResponse {
    users: Vec<User>,
}

fn main() -> Result<(), Box<dyn std::error::Error>> {
    let config = queries::config()?;
    let db = HelixDB::new("./data", config)?;

    let data: GetUsersResponse = db.execute("GetUsers", json!({}))?.deserialize()?;

    println!("Found {} users", data.users.len());
    Ok(())
}
```

## API

### HelixDB::new(path, config)

Create a new database instance.

```rust
let db = HelixDB::new("./my_data", config)?;
```

### execute(query_name, params)

Execute a query by name.

```rust
let response = db.execute("GetUsers", json!({}))?;
```

### Response Methods

Chain these on the response:

```rust
// Deserialize to type
let data: MyType = response.deserialize()?;

// Get JSON value
let json = response.json()?;

// Extract field
let users: Vec<User> = response.get_field("users")?;
```

## File Structure

```
your-project/
├── build.rs              # Compiles .hx files
├── queries/
│   ├── schema.hx        # Define nodes/edges
│   └── queries.hx       # Define queries
└── src/
    ├── main.rs          # Your code
    └── queries.rs       # Generated (don't edit)
```

## Build Process

1. `cargo build` runs `build.rs`
2. Compiles `queries/*.hx` files
3. Generates `src/queries.rs` with handlers
4. Your code imports `mod queries`

## Examples

### Execute with Parameters

```rust
let response = db.execute("CreateUser", json!({
    "name": "Alice",
    "email": "alice@example.com"
}))?;
```

### Dynamic JSON Access

```rust
let json = db.execute("GetUsers", json!({}))?.json()?;
println!("{}", json["users"]);
```

### Field Extraction

```rust
let users: Vec<User> = db.execute("GetUsers", json!({}))?.get_field("users")?;
```

## That's It

No runtime compilation. No servers. Just embedded graph database queries.
